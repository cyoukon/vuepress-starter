<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.63" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/vuepress-starter/guide/MQ/Redis/Redis%20MQ.html"><meta property="og:site_name" content="文档演示"><meta property="og:title" content="Redis 消息队列的三种方案（List、Streams、Pub/Sub）"><meta property="og:description" content="Redis 消息队列的三种方案（List、Streams、Pub/Sub） 现如今的互联网应用大都是采用 分布式系统架构 设计的，所以 消息队列 已经逐渐成为企业应用系统 内部通信 的核心手段， 它具有 低耦合、可靠投递、广播、流量控制、最终一致性 等一系列功能。 当前使用较多的 消息队列 有 RabbitMQ、RocketMQ、ActiveMQ、Ka..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-12-10T08:55:51.000Z"><meta property="article:modified_time" content="2024-12-10T08:55:51.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Redis 消息队列的三种方案（List、Streams、Pub/Sub）","image":[""],"dateModified":"2024-12-10T08:55:51.000Z","author":[{"@type":"Person","name":"Mr.Hope","url":"https://mister-hope.com"}]}</script><link rel="icon" href="/vuepress-starter/./favicon.ico"><title>Redis 消息队列的三种方案（List、Streams、Pub/Sub） | 文档演示</title><meta name="description" content="Redis 消息队列的三种方案（List、Streams、Pub/Sub） 现如今的互联网应用大都是采用 分布式系统架构 设计的，所以 消息队列 已经逐渐成为企业应用系统 内部通信 的核心手段， 它具有 低耦合、可靠投递、广播、流量控制、最终一致性 等一系列功能。 当前使用较多的 消息队列 有 RabbitMQ、RocketMQ、ActiveMQ、Ka...">
    <link rel="preload" href="/vuepress-starter/assets/style-DmRZqqtw.css" as="style"><link rel="stylesheet" href="/vuepress-starter/assets/style-DmRZqqtw.css">
    <link rel="modulepreload" href="/vuepress-starter/assets/app-dX-INNG3.js"><link rel="modulepreload" href="/vuepress-starter/assets/Redis MQ.html-ARIXkMin.js"><link rel="modulepreload" href="/vuepress-starter/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/vuepress-starter/assets/index.html-B4kErn1x.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/portfolio.html-DxBb2yRT.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-BC2LJUPk.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/disable.html-BmcDs4kq.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/encrypt.html-3Cp4MjKx.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/layout.html-q2pmD4J9.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/markdown.html-BKQ3c-qt.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/page.html-BMeZ-R-O.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-D617Cd47.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/技术.html-BIuIoJd0.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/docker-compose.html-BnPEHZwR.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/docker.html-B-b6n7Jv.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/ES.html-C4WrQWs_.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/markdownTest.html-Bzq2Zz1p.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Redis基本概念.html-CL-ifA18.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/SQL standard.html-Cgrewygu.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/doc.html-DFJAmfsq.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/RESTfulAPI.html-B-MCtuq-.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Leetcode算法入门.html-CR28XKiW.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/算法随记.html-BolJeJyy.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-BY9eJklc.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Kubernetes Memo.html-Dea3i-O1.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Kubernetes.html-OfnmjgdO.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/redis_docker.html-BZ8o1KO3.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/使用.html-BnaFaZpN.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/源码.html-CIwTu78X.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/MiddlewareAndFilters.html-9REEWqh9.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/RabbitMQ.html-BlXsf32s.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Step.html-2uazlWa3.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/MySqlNote.html-DnmrpIUh.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/sql备忘.html-DkMHoKag.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/SocketDoc.html-Fluq_nNO.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/SignalRDoc.html-DnD9dZmR.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/VueDoc.html-C_EWTPCp.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Mediator.html-BK6lFtj8.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Flyweight.html-CPCXnPMH.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Proxy.html-GDWfom1a.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Singleton.html-Dq73jbXo.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Prototype.html-DypgduWq.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Command.html-Dt6XZO1d.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Memento.html-S3JEDXK0.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Facade.html-CD3LJXxw.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Factory Method.html-Ca76I-xD.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Builder.html-B2Cy5Snv.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Abstract Factory.html-Dvjuwd0q.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Bridge.html-CMcafQaa.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Template Method.html-BnqtUGuf.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/State.html-tdRUfn-X.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Strategy.html-DvEzrnxg.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/SimpleFactory.html-D98LRHLo.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Composite.html-CZv3Xjfh.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Decorator.html-BV7nBDEw.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Observer.html-B5jhQM57.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Interpreter.html-BIOsAK4W.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Visitor.html-BGyv7mYp.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Chain of Resp.html-D2gG486n.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Iterator.html-BPzCPRIR.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Adapter.html-fYw8io_V.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/LICENSE.html-DLVhr-ZW.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-DOgkLkU_.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/404.html-Ci5Ei-d5.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-C_OdW2gO.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-CCBdygxs.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-UvZkSI3c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-tpGAtgqV.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-CsEcwgpw.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-B8gCGOXP.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-CnvPpztt.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-0jIUYuV7.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-Cgc3ITUL.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-CxJJ-yIC.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-zVrtsAUN.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-QY0CwEG1.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-PX6rvJlq.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-2nqwe2S_.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-DHXgMiU4.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-CFBXLzyI.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-RPHeyf6E.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-DAbZClNU.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-BHS5hNHB.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-CBVVRV8t.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-pMmTGC05.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-BCcQV-sU.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-l-2Anq-c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-CDwKycuS.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-CtisK_Tw.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-PGSEjtOj.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-CGnGMDnb.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-7pouMhT7.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-BF5QxsC5.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-SL6btJiG.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-Br359bxq.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-LtGOnpK6.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-CRmvP0RD.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-BbAfWogJ.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-k2zE8hNp.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-EreouHU6.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-CabqCNj_.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-Cc_Rhd6Q.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-CqGVepzc.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-C7ukO3yD.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-Dz16QyN5.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-BDebLiKl.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-yn1Zrazj.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-Dt8cFp7A.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-BSU19XTq.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-q9_e3sKc.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/giscus-BZxmVUME.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/setupDevtools-7MC2TMWH-4fegamXB.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/vuepress-starter/" aria-label="带我回家"><img class="vp-nav-logo" src="/vuepress-starter/./logo.svg" alt><!----><span class="vp-site-name hide-in-pad">文档演示</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/vuepress-starter/" aria-label="项目主页"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->项目主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/vuepress-starter/portfolio.html" aria-label="档案主页"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->档案主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/vuepress-starter/demo/" aria-label="主要功能与配置演示"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><!--]-->主要功能与配置演示<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="指南"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>指南<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">Bar</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-starter/guide/bar/baz.html" aria-label="/guide/bar/baz.html"><!---->/guide/bar/baz.html<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-starter/guide/bar/" aria-label="..."><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-ellipsis" style=""></span><!--]-->...<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">Foo</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-starter/guide/foo/ray.html" aria-label="/guide/foo/ray.html"><!---->/guide/foo/ray.html<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/vuepress-starter/guide/foo/" aria-label="..."><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-ellipsis" style=""></span><!--]-->...<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="auto-link external-link" href="https://theme-hope.vuejs.press/zh/" aria-label="V2 文档" rel="noopener noreferrer" target="_blank"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><!--]-->V2 文档<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-starter/" aria-label="项目主页"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->项目主页<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-starter/portfolio.html" aria-label="档案主页"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->档案主页<!----></a></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/vuepress-starter/demo/" aria-label="案例"><!---->案例<!----></a><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-starter/demo/markdown.html" aria-label="Markdown 展示"><!--[--><span class="font-icon icon fa-fw fa-sm fab fa-markdown" style=""></span><!--]-->Markdown 展示<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-starter/demo/layout.html" aria-label="布局"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-object-group" style=""></span><!--]-->布局<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-starter/demo/page.html" aria-label="页面配置"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-file" style=""></span><!--]-->页面配置<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-starter/demo/disable.html" aria-label="布局与功能禁用"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-gears" style=""></span><!--]-->布局与功能禁用<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-starter/demo/encrypt.html" aria-label="密码加密的文章"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-lock" style=""></span><!--]-->密码加密的文章<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header active"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">文档</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-starter/guide/" aria-label="指南"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><!--]-->指南<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/vuepress-starter/guide/%E6%8A%80%E6%9C%AF.html" aria-label="/guide/%E6%8A%80%E6%9C%AF.html"><!---->/guide/%E6%8A%80%E6%9C%AF.html<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">ASP. NET</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Docker</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Elastic Search</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">MQ</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Rabbit MQ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Redis</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/vuepress-starter/guide/MQ/Redis/Redis%20MQ.html" aria-label="Redis 消息队列的三种方案（List、Streams、Pub/Sub）"><!---->Redis 消息队列的三种方案（List、Streams、Pub/Sub）<!----></a></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Others</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Socket</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">SQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">前端</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">接口规范</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">算法</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">设计模式</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><a class="auto-link external-link vp-sidebar-link" href="https://ecosystem.vuejs.press/zh/plugins/markdown/revealjs/demo.html" aria-label="幻灯片" rel="noopener noreferrer" target="_blank"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-person-chalkboard" style=""></span><!--]-->幻灯片<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Redis 消息队列的三种方案（List、Streams、Pub/Sub）</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://mister-hope.com" target="_blank" rel="noopener noreferrer">Mr.Hope</a></span><span property="author" content="Mr.Hope"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2024年12月10日</span><meta property="datePublished" content="2024-12-10T08:55:51.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 16 分钟</span><meta property="timeRequired" content="PT16M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc" vp-toc><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#一、回顾消息队列">一、回顾消息队列</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#二、redis-实现消息队列">二、Redis 实现消息队列</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-1-list-实现消息队列">2.1 List 实现消息队列</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-2-订阅与发布实现消息队列">2.2 订阅与发布实现消息队列</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-3-streams-实现消息队列">2.3 Streams 实现消息队列</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#写在最后">写在最后</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#参考">参考</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content" vp-content><h1 id="redis-消息队列的三种方案-list、streams、pub-sub" tabindex="-1"><a class="header-anchor" href="#redis-消息队列的三种方案-list、streams、pub-sub"><span>Redis 消息队列的三种方案（List、Streams、Pub/Sub）</span></a></h1><p>现如今的互联网应用大都是采用 <strong>分布式系统架构</strong> 设计的，所以 <strong>消息队列</strong> 已经逐渐成为企业应用系统 <strong>内部通信</strong> 的核心手段，</p><p>它具有 <strong>低耦合</strong>、<strong>可靠投递</strong>、<strong>广播</strong>、<strong>流量控制</strong>、<strong>最终一致性</strong> 等一系列功能。</p><p>当前使用较多的 <strong>消息队列</strong> 有 <code>RabbitMQ</code>、<code>RocketMQ</code>、<code>ActiveMQ</code>、<code>Kafka</code>、<code>ZeroMQ</code>、<code>MetaMQ</code> 等，而部分<strong>数据库</strong> 如 <code>Redis</code>、<code>MySQL</code> 以及 <code>phxsql</code> ，如果硬搞的话，其实也可实现消息队列的功能。</p><p>可能有人觉得，各种开源的 MQ 已经足够使用了，为什么需要用 Redis 实现 MQ 呢？</p><ul><li>有些简单的业务场景，可能不需要重量级的 MQ 组件（相比 Redis 来说，Kafka 和 RabbitMQ 都算是重量级的消息队列）</li></ul><p>那你有考虑过用 Redis 做消息队列吗？</p><p>这一章，我会结合消息队列的特点和 Redis 做消息队列的使用方式，以及实际项目中的使用，来和大家探讨下 Redis 消息队列的方案。</p><h2 id="一、回顾消息队列" tabindex="-1"><a class="header-anchor" href="#一、回顾消息队列"><span>一、回顾消息队列</span></a></h2><blockquote><p><strong>消息队列</strong> 是指利用 <strong>高效可靠</strong> 的 <strong>消息传递机制</strong> 进行与平台无关的 <strong>数据交流</strong>，并基于<strong>数据通信</strong>来进行分布式系统的集成。</p><p>通过提供 <strong>消息传递</strong> 和 <strong>消息排队</strong> 模型，它可以在 <strong>分布式环境</strong> 下提供 <strong>应用解耦</strong>、<strong>弹性伸缩</strong>、<strong>冗余存储</strong>、<strong>流量削峰</strong>、<strong>异步通信</strong>、<strong>数据同步</strong> 等等功能，其作为 <strong>分布式系统架构</strong> 中的一个重要组件，有着举足轻重的地位。</p></blockquote><p>![图片](Redis MQ.assets/640.webp)mq_overview</p><p>现在回顾下，我们使用的消息队列，一般都有什么样的特点：</p><ul><li>三个角色：生产者、消费者、消息处理中心</li><li>异步处理模式：<strong>生产者</strong> 将消息发送到一条 <strong>虚拟的通道</strong>（消息队列）上，而无须等待响应。<strong>消费者</strong> 则 <strong>订阅</strong> 或是 <strong>监听</strong> 该通道，取出消息。两者互不干扰，甚至都不需要同时在线，也就是我们说的 <strong>松耦合</strong></li><li>可靠性：消息要可以保证不丢失、不重复消费、有时可能还需要顺序性的保证</li></ul><p>撇开我们常用的消息中间件不说，你觉得 Redis 的哪些数据类型可以满足 MQ 的常规需求~~</p><h2 id="二、redis-实现消息队列" tabindex="-1"><a class="header-anchor" href="#二、redis-实现消息队列"><span>二、Redis 实现消息队列</span></a></h2><p>思来想去，只有 List 和 Streams 两种数据类型，可以实现消息队列的这些需求，当然，Redis 还提供了发布、订阅(pub/sub) 模式。</p><p>我们逐一看下这 3 种方式的使用和场景。</p><h3 id="_2-1-list-实现消息队列" tabindex="-1"><a class="header-anchor" href="#_2-1-list-实现消息队列"><span>2.1 List 实现消息队列</span></a></h3><p>Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）。</p><p>所以常用来做<strong>异步队列</strong>使用。将需要延后处理的任务结构体序列化成字符串塞进 Redis 的列表，另一个线程从这个列表中轮询数据进行处理。</p><p>Redis 提供了好几对 List 指令，先大概看下这些命令，混个眼熟</p><h4 id="list-常用命令" tabindex="-1"><a class="header-anchor" href="#list-常用命令"><span>List 常用命令</span></a></h4><table><thead><tr><th style="text-align:left;">命令</th><th style="text-align:left;">用法</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>LPUSH</strong></td><td style="text-align:left;">LPUSH key value [value ...]</td><td style="text-align:left;">将一个或多个值 value 插入到列表 key 的表头如果有多个 value 值，那么各个 value 值按从左到右的顺序依次插入到表头</td></tr><tr><td style="text-align:left;"><strong>RPUSH</strong></td><td style="text-align:left;">RPUSH key value [value ...]</td><td style="text-align:left;">将一个或多个值 value 插入到列表 key 的表尾(最右边)</td></tr><tr><td style="text-align:left;"><strong>LPOP</strong></td><td style="text-align:left;">LPOP key</td><td style="text-align:left;">移除并返回列表 key 的头元素。</td></tr><tr><td style="text-align:left;"><strong>BLPOP</strong></td><td style="text-align:left;">BLPOP key [key ...] timeout</td><td style="text-align:left;">移出并获取列表的第一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止</td></tr><tr><td style="text-align:left;"><strong>RPOP</strong></td><td style="text-align:left;">RPOP key</td><td style="text-align:left;">移除并返回列表 key 的尾元素。</td></tr><tr><td style="text-align:left;"><strong>BRPOP</strong></td><td style="text-align:left;">BRPOP key [key ...] timeout</td><td style="text-align:left;">移出并获取列表的最后一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td></tr><tr><td style="text-align:left;">BRPOPLPUSH</td><td style="text-align:left;">BRPOPLPUSH source destination timeout</td><td style="text-align:left;">从列表中弹出一个值，将弹出的元素插入到另外一个列表中并返回它；如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td></tr><tr><td style="text-align:left;">RPOPLPUSH</td><td style="text-align:left;">RPOPLPUSH source destinationb</td><td style="text-align:left;">命令 RPOPLPUSH 在一个原子时间内，执行以下两个动作：将列表 source 中的最后一个元素(尾元素)弹出，并返回给客户端。将 source 弹出的元素插入到列表 destination ，作为 destination 列表的的头元素</td></tr><tr><td style="text-align:left;"><strong>LLEN</strong></td><td style="text-align:left;">LLEN key</td><td style="text-align:left;">返回列表 key 的长度。如果 key 不存在，则 key 被解释为一个空列表，返回 0 .如果 key 不是列表类型，返回一个错误</td></tr><tr><td style="text-align:left;"><strong>LRANGE</strong></td><td style="text-align:left;">LRANGE key start stop</td><td style="text-align:left;">返回列表 key 中指定区间内的元素，区间以偏移量 start 和 stop 指定</td></tr></tbody></table><p>挑几个弹入、弹出的命令就可以组合出很多<strong>姿势</strong></p><ul><li>LPUSH、RPOP 左进右出</li><li>RPUSH、LPOP 右进左出</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:6379&gt; lpush mylist a a b c d e</span></span>
<span class="line"><span>(integer) 6</span></span>
<span class="line"><span>127.0.0.1:6379&gt; rpop mylist</span></span>
<span class="line"><span>&quot;a&quot;</span></span>
<span class="line"><span>127.0.0.1:6379&gt; rpop mylist</span></span>
<span class="line"><span>&quot;a&quot;</span></span>
<span class="line"><span>127.0.0.1:6379&gt; rpop mylist</span></span>
<span class="line"><span>&quot;b&quot;</span></span>
<span class="line"><span>127.0.0.1:6379&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>![图片](Redis MQ.assets/640-16408353233671.webp)redis-RPOP</p><h4 id="即时消费问题" tabindex="-1"><a class="header-anchor" href="#即时消费问题"><span>即时消费问题</span></a></h4><p>通过 <code>LPUSH</code>，<code>RPOP</code> 这样的方式，会存在一个性能风险点，就是消费者如果想要及时的处理数据，就要在程序中写个类似 <code>while(true)</code> 这样的逻辑，不停的去调用 RPOP 或 LPOP 命令，这就会给消费者程序带来些不必要的性能损失。</p><p>所以，Redis 还提供了 <code>BLPOP</code>、<code>BRPOP</code> 这种阻塞式读取的命令（带 B-Bloking的都是阻塞式），客户端在没有读到队列数据时，自动阻塞，直到有新的数据写入队列，再开始读取新数据。这种方式就节省了不必要的 CPU 开销。</p><ul><li>LPUSH、BRPOP 左进右阻塞出</li><li>RPUSH、BLPOP 右进左阻塞出</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:6379&gt; lpush yourlist a b c d</span></span>
<span class="line"><span>(integer) 4</span></span>
<span class="line"><span>127.0.0.1:6379&gt; blpop yourlist 10</span></span>
<span class="line"><span>1) &quot;yourlist&quot;</span></span>
<span class="line"><span>2) &quot;d&quot;</span></span>
<span class="line"><span>127.0.0.1:6379&gt; blpop yourlist 10</span></span>
<span class="line"><span>1) &quot;yourlist&quot;</span></span>
<span class="line"><span>2) &quot;c&quot;</span></span>
<span class="line"><span>127.0.0.1:6379&gt; blpop yourlist 10</span></span>
<span class="line"><span>1) &quot;yourlist&quot;</span></span>
<span class="line"><span>2) &quot;b&quot;</span></span>
<span class="line"><span>127.0.0.1:6379&gt; blpop yourlist 10</span></span>
<span class="line"><span>1) &quot;yourlist&quot;</span></span>
<span class="line"><span>2) &quot;a&quot;</span></span>
<span class="line"><span>127.0.0.1:6379&gt; blpop yourlist 10</span></span>
<span class="line"><span>(nil)</span></span>
<span class="line"><span>(10.02s)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>如果将超时时间设置为 0 时，即可无限等待，直到弹出消息</strong></p><p>因为 Redis 单线程的特点，所以在消费数据时，同一个消息会不会同时被多个 <code>consumer</code> 消费掉，但是需要我们考虑消费不成功的情况。</p><h4 id="可靠队列模式-ack-机制" tabindex="-1"><a class="header-anchor" href="#可靠队列模式-ack-机制"><span>可靠队列模式 | ack 机制</span></a></h4><p>以上方式中， List 队列中的消息一经发送出去，便从队列里删除。如果由于网络原因消费者没有收到消息，或者消费者在处理这条消息的过程中崩溃了，就再也无法还原出这条消息。究其原因，就是缺少消息确认机制。</p><p>为了保证消息的可靠性，消息队列都会有完善的消息确认机制（Acknowledge），即消费者向队列报告消息已收到或已处理的机制。</p><p><strong>Redis List 怎么搞一搞呢？</strong></p><p>再看上边的表格中，有两个命令， <code>RPOPLPUSH</code>、<code>BRPOPLPUSH</code> （阻塞）从一个 list 中获取消息的同时把这条消息复制到另一个 list 里（可以当做备份），而且这个过程是原子的。</p><p>这样我们就可以在业务流程安全结束后，再删除队列元素，实现消息确认机制。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:6379&gt; rpush myqueue one</span></span>
<span class="line"><span>(integer) 1</span></span>
<span class="line"><span>127.0.0.1:6379&gt; rpush myqueue two</span></span>
<span class="line"><span>(integer) 2</span></span>
<span class="line"><span>127.0.0.1:6379&gt; rpush myqueue three</span></span>
<span class="line"><span>(integer) 3</span></span>
<span class="line"><span>127.0.0.1:6379&gt; rpoplpush myqueue queuebak</span></span>
<span class="line"><span>&quot;three&quot;</span></span>
<span class="line"><span>127.0.0.1:6379&gt; lrange myqueue 0 -1</span></span>
<span class="line"><span>1) &quot;one&quot;</span></span>
<span class="line"><span>2) &quot;two&quot;</span></span>
<span class="line"><span>127.0.0.1:6379&gt; lrange queuebak 0 -1</span></span>
<span class="line"><span>1) &quot;three&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>![图片](Redis MQ.assets/640-16408353233682.webp)redis-rpoplpush</p><p>之前做过的项目中就有用到这样的方式去处理数据，数据标识从一个 List 取出后放入另一个 List，业务操作安全执行完成后，再去删除 List 中的数据，如果有问题的话，很好回滚。</p><p>当然，还有更特殊的场景，可以通过 <strong>zset</strong> 来实现<strong>延时消息队列</strong>，原理就是将消息加到 zset 结构后，将要被消费的时间戳设置为对应的 score 即可，只要业务数据不会是重复数据就 OK。</p><h3 id="_2-2-订阅与发布实现消息队列" tabindex="-1"><a class="header-anchor" href="#_2-2-订阅与发布实现消息队列"><span>2.2 订阅与发布实现消息队列</span></a></h3><p>我们都知道消息模型有两种</p><ul><li>点对点：Point-to-Point(P2P)</li><li>发布订阅：Publish/Subscribe(Pub/Sub)</li></ul><p>List 实现方式其实就是点对点的模式，下边我们再看下 Redis 的发布订阅模式（消息多播），这才是“根正苗红”的 Redis MQ</p><p>![图片](Redis MQ.assets/640-16408353233683.webp)redis-pub_sub</p><p>&quot;发布/订阅&quot;模式同样可以实现进程间的消息传递，其原理如下:</p><p>&quot;发布/订阅&quot;模式包含两种角色，分别是发布者和订阅者。订阅者可以订阅一个或者多个频道(channel)，而发布者可以向指定的频道(channel)发送消息，所有订阅此频道的订阅者都会收到此消息。</p><p>Redis 通过 <code>PUBLISH</code> 、 <code>SUBSCRIBE</code> 等命令实现了订阅与发布模式， 这个功能提供两种信息机制， 分别是订阅/发布到频道和订阅/发布到模式。</p><p>这个 <strong>频道</strong> 和 <strong>模式</strong> 有什么区别呢？</p><p>频道我们可以先理解为是个 Redis 的 key 值，而模式，可以理解为是一个类似正则匹配的 Key，只是个可以匹配给定模式的频道。这样就不需要显式的去订阅多个名称了，可以通过模式订阅这种方式，一次性关注多个频道。</p><p>我们启动三个 Redis 客户端看下效果：</p><p>![图片](Redis MQ.assets/640-16408353233684.webp)redis-subscribe</p><p>先启动两个客户端订阅（subscribe） 名字叫 framework 的频道，然后第三个客户端往 framework 发消息，可以看到前两个客户端都会接收到对应的消息：</p><p>![图片](Redis MQ.assets/640-16408353233685.webp)redis-publish</p><p>我们可以看到订阅的客户端每次可以收到一个 3 个参数的消息，分别为：</p><ul><li>消息的种类</li><li>始发频道的名称</li><li>实际的消息</li></ul><p>再来看下订阅符合给定<strong>模式</strong>的频道，这回订阅的命令是 <code>PSUBSCRIBE</code></p><p>![图片](Redis MQ.assets/640-16408353233686.webp)redis-psubscribe</p><p>我们往 <code>java.framework</code> 这个频道发送了一条消息，不止订阅了该频道的 Consumer1 和 Consumer2 可以接收到消息，订阅了模式 <code>java.*</code> 的 Consumer3 和 Consumer4 也可以接收到消息。</p><p>![图片](Redis MQ.assets/640-16408353233687.webp)redis-psubscribe1</p><h4 id="pub-sub-常用命令" tabindex="-1"><a class="header-anchor" href="#pub-sub-常用命令"><span>Pub/Sub 常用命令：</span></a></h4><table><thead><tr><th style="text-align:left;">命令</th><th style="text-align:left;">用法</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">PSUBSCRIBE</td><td style="text-align:left;">PSUBSCRIBE pattern [pattern ...]</td><td style="text-align:left;">订阅一个或多个符合给定模式的频道</td></tr><tr><td style="text-align:left;">PUBSUB</td><td style="text-align:left;">PUBSUB subcommand [argument [argument ...]]</td><td style="text-align:left;">查看订阅与发布系统状态</td></tr><tr><td style="text-align:left;">PUBLISH</td><td style="text-align:left;">PUBLISH channel message</td><td style="text-align:left;">将信息发送到指定的频道</td></tr><tr><td style="text-align:left;">PUNSUBSCRIBE</td><td style="text-align:left;">PUNSUBSCRIBE [pattern [pattern ...]]</td><td style="text-align:left;">退订所有给定模式的频道</td></tr><tr><td style="text-align:left;">SUBSCRIBE</td><td style="text-align:left;">SUBSCRIBE channel [channel ...]</td><td style="text-align:left;">订阅给定的一个或多个频道的信息</td></tr><tr><td style="text-align:left;">UNSUBSCRIBE</td><td style="text-align:left;">UNSUBSCRIBE [channel [channel ...]]</td><td style="text-align:left;">指退订给定的频道</td></tr></tbody></table><h3 id="_2-3-streams-实现消息队列" tabindex="-1"><a class="header-anchor" href="#_2-3-streams-实现消息队列"><span>2.3 Streams 实现消息队列</span></a></h3><p>Redis 发布订阅 (pub/sub) 有个缺点就是消息无法持久化，如果出现网络断开、Redis 宕机等，消息就会被丢弃。而且也没有 Ack 机制来保证数据的可靠性，假设一个消费者都没有，那消息就直接被丢弃了。</p><blockquote><p>后来 Redis 的父亲 Antirez，又单独开启了一个叫 Disque 的项目来完善这些问题，但是没有做起来，github 的更新也定格在了 5 年前，所以我们就不讨论了。</p></blockquote><p>Redis 5.0 版本新增了一个更强大的数据结构——<strong>Stream</strong>。它提供了消息的持久化和主备复制功能，可以让任何客户端访问任何时刻的数据，并且能记住每一个客户端的访问位置，还能保证消息不丢失。</p><p>它就像是个仅追加内容的<strong>消息链表</strong>，把所有加入的消息都串起来，每个消息都有一个唯一的 ID 和对应的内容。而且消息是持久化的。</p><p>![图片](Redis MQ.assets/640-16408353233688.webp)redis-stream</p><p>每个 Stream 都有唯一的名称，它就是 Redis 的 key，在我们首次使用 xadd 指令追加消息时自动创建。</p><p>Streams 是 Redis 专门为消息队列设计的数据类型，所以提供了丰富的消息队列操作命令。</p><h4 id="stream-常用命令" tabindex="-1"><a class="header-anchor" href="#stream-常用命令"><span>Stream 常用命令</span></a></h4><table><thead><tr><th style="text-align:left;">描述</th><th style="text-align:left;">用法</th></tr></thead><tbody><tr><td style="text-align:left;">添加消息到末尾，保证有序，可以自动生成唯一ID</td><td style="text-align:left;">XADD key ID field value [field value ...]</td></tr><tr><td style="text-align:left;">对流进行修剪，限制长度</td><td style="text-align:left;">XTRIM key MAXLEN [~] count</td></tr><tr><td style="text-align:left;">删除消息</td><td style="text-align:left;">XDEL key ID [ID ...]</td></tr><tr><td style="text-align:left;">获取流包含的元素数量，即消息长度</td><td style="text-align:left;">XLEN key</td></tr><tr><td style="text-align:left;">获取消息列表，会自动过滤已经删除的消息</td><td style="text-align:left;">XRANGE key start end [COUNT count]</td></tr><tr><td style="text-align:left;">以阻塞或非阻塞方式获取消息列表</td><td style="text-align:left;">XREAD [COUNT count] [BLOCK milliseconds] STREAMS key [key ...] id [id ...]</td></tr><tr><td style="text-align:left;">创建消费者组</td><td style="text-align:left;">XGROUP [CREATE key groupname id-or-] [DESTROY key groupname] [DELCONSUMER key groupname consumername]</td></tr><tr><td style="text-align:left;">读取消费者组中的消息</td><td style="text-align:left;">XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] [NOACK] STREAMS key [key ...] ID [ID ...]</td></tr><tr><td style="text-align:left;">将消息标记为&quot;已处理&quot;</td><td style="text-align:left;">XACK key group ID [ID ...]</td></tr><tr><td style="text-align:left;">为消费者组设置新的最后递送消息ID</td><td style="text-align:left;">XGROUP SETID [CREATE key groupname id-or-] [DESTROY key groupname]</td></tr><tr><td style="text-align:left;">删除消费者</td><td style="text-align:left;">XGROUP DELCONSUMER [CREATE key groupname id-or-] [DESTROY key groupname]</td></tr><tr><td style="text-align:left;">删除消费者组</td><td style="text-align:left;">XGROUP DESTROY [CREATE key groupname id-or-] [DESTROY key groupname] [DEL</td></tr><tr><td style="text-align:left;">显示待处理消息的相关信息</td><td style="text-align:left;">XPENDING key group [start end count] [consumer]</td></tr><tr><td style="text-align:left;">查看流和消费者组的相关信息</td><td style="text-align:left;">XINFO [CONSUMERS key groupname] [GROUPS key] [STREAM key] [HELP]</td></tr><tr><td style="text-align:left;">打印流信息</td><td style="text-align:left;">XINFO STREAM [CONSUMERS key groupname] [GROUPS key] [STREAM key] [HELP]</td></tr></tbody></table><h4 id="crud-工程师上线" tabindex="-1"><a class="header-anchor" href="#crud-工程师上线"><span>CRUD 工程师上线</span></a></h4><h5 id="增删改查来一波" tabindex="-1"><a class="header-anchor" href="#增删改查来一波"><span>增删改查来一波</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># * 号表示服务器自动生成 ID，后面顺序跟着一堆 key/value</span></span>
<span class="line"><span>127.0.0.1:6379&gt; xadd mystream * f1 v1 f2 v2 f3 v3</span></span>
<span class="line"><span>&quot;1609404470049-0&quot;  ## 生成的消息 ID，有两部分组成，毫秒时间戳-该毫秒内产生的第1条消息</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 消息ID 必须要比上个 ID 大</span></span>
<span class="line"><span>127.0.0.1:6379&gt; xadd mystream 123 f4 v4  </span></span>
<span class="line"><span>(error) ERR The ID specified in XADD is equal or smaller than the target stream top item</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 自定义ID</span></span>
<span class="line"><span>127.0.0.1:6379&gt; xadd mystream 1609404470049-1 f4 v4</span></span>
<span class="line"><span>&quot;1609404470049-1&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># -表示最小值 , + 表示最大值,也可以指定最大消息ID，或最小消息ID，配合 -、+ 使用</span></span>
<span class="line"><span>127.0.0.1:6379&gt; xrange mystream - +</span></span>
<span class="line"><span>1) 1) &quot;1609404470049-0&quot;</span></span>
<span class="line"><span>   2) 1) &quot;f1&quot;</span></span>
<span class="line"><span>      2) &quot;v1&quot;</span></span>
<span class="line"><span>      3) &quot;f2&quot;</span></span>
<span class="line"><span>      4) &quot;v2&quot;</span></span>
<span class="line"><span>      5) &quot;f3&quot;</span></span>
<span class="line"><span>      6) &quot;v3&quot;</span></span>
<span class="line"><span>2) 1) &quot;1609404470049-1&quot;</span></span>
<span class="line"><span>   2) 1) &quot;f4&quot;</span></span>
<span class="line"><span>      2) &quot;v4&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>127.0.0.1:6379&gt; xdel mystream 1609404470049-1</span></span>
<span class="line"><span>(integer) 1</span></span>
<span class="line"><span>127.0.0.1:6379&gt; xlen mystream</span></span>
<span class="line"><span>(integer) 1</span></span>
<span class="line"><span># 删除整个 stream</span></span>
<span class="line"><span>127.0.0.1:6379&gt; del mystream</span></span>
<span class="line"><span>(integer) 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="独立消费" tabindex="-1"><a class="header-anchor" href="#独立消费"><span>独立消费</span></a></h5><p><code>xread</code> 以阻塞或非阻塞方式获取消息列表，指定 <code>BLOCK</code> 选项即表示阻塞，超时时间 0 毫秒（意味着永不超时）</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># 从ID是0-0的开始读前2条</span></span>
<span class="line"><span>127.0.0.1:6379&gt; xread count 2 streams mystream 0</span></span>
<span class="line"><span>1) 1) &quot;mystream&quot;</span></span>
<span class="line"><span>   2) 1) 1) &quot;1609405178536-0&quot;</span></span>
<span class="line"><span>         2) 1) &quot;f5&quot;</span></span>
<span class="line"><span>            2) &quot;v5&quot;</span></span>
<span class="line"><span>      2) 1) &quot;1609405198676-0&quot;</span></span>
<span class="line"><span>         2) 1) &quot;f1&quot;</span></span>
<span class="line"><span>            2) &quot;v1&quot;</span></span>
<span class="line"><span>            3) &quot;f2&quot;</span></span>
<span class="line"><span>            4) &quot;v2&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 阻塞的从尾部读取流，开启新的客户端xadd后发现这里就读到了,block 0 表示永久阻塞</span></span>
<span class="line"><span>127.0.0.1:6379&gt; xread block 0 streams mystream $</span></span>
<span class="line"><span>1) 1) &quot;mystream&quot;</span></span>
<span class="line"><span>   2) 1) 1) &quot;1609408791503-0&quot;</span></span>
<span class="line"><span>         2) 1) &quot;f6&quot;</span></span>
<span class="line"><span>            2) &quot;v6&quot;</span></span>
<span class="line"><span>(42.37s)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，我并没有给流 <code>mystream</code> 传入一个常规的 ID，而是传入了一个特殊的 ID <code>$</code>这个特殊的 ID 意思是 <strong>XREAD</strong> 应该使用流 <code>mystream</code> 已经存储的最大 ID 作为最后一个 ID。以便我们仅接收从我们开始监听时间以后的新消息。这在某种程度上相似于 Unix 命令<code>tail -f</code>。</p><p>当然，也可以指定任意有效的 ID。</p><p>而且， <code>XREAD</code> 的阻塞形式还可以同时监听多个 Strema，只需要指定多个键名即可。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>127.0.0.1:6379&gt; xread block 0 streams mystream yourstream $ $</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h5 id="创建消费者组" tabindex="-1"><a class="header-anchor" href="#创建消费者组"><span>创建消费者组</span></a></h5><p><code>xread</code> 虽然可以扇形分发到 N 个客户端，然而，在某些问题中，我们想要做的不是向许多客户端提供相同的消息流，而是从同一流向许多客户端提供不同的消息子集。比如下图这样，三个消费者按轮训的方式去消费一个 Stream。</p><p>![图片](Redis MQ.assets/640-16408353233689.webp)redis-stream-cg</p><p>Redis Stream 借鉴了很多 Kafka 的设计。</p><ul><li><strong>Consumer Group</strong>：有了消费组的概念，每个消费组状态独立，互不影响，一个消费组可以有多个消费者</li><li><strong>last_delivered_id</strong> ：每个消费组会有个游标 last_delivered_id 在数组之上往前移动，表示当前消费组已经消费到哪条消息了</li><li><strong>pending_ids</strong> ：消费者的状态变量，作用是维护消费者的未确认的 id。pending_ids 记录了当前已经被客户端读取的消息，但是还没有 ack。如果客户端没有 ack，这个变量里面的消息 ID 会越来越多，一旦某个消息被 ack，它就开始减少。这个 pending_ids 变量在 Redis 官方被称之为 <code>PEL</code>，也就是 <code>Pending Entries List</code>，这是一个很核心的数据结构，它用来确保客户端至少消费了消息一次，而不会在网络传输的中途丢失了没处理。</li></ul><p>![图片](Redis MQ.assets/640-164083532336910.webp)redis-group-strucure</p><p>Stream 不像 Kafak 那样有分区的概念，如果想实现类似分区的功能，就要在客户端使用一定的策略将消息写到不同的 Stream。</p><ul><li><code>xgroup create</code>：创建消费者组</li><li><code>xgreadgroup</code>：读取消费组中的消息</li><li><code>xack</code>：ack 掉指定消息</li></ul><p>![图片](Redis MQ.assets/640-164083532336911.webp)</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># 创建消费者组的时候必须指定 ID, ID 为 0 表示从头开始消费，为 $ 表示只消费新的消息，也可以自己指定</span></span>
<span class="line"><span>127.0.0.1:6379&gt; xgroup create mystream mygroup $</span></span>
<span class="line"><span>OK</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 查看流和消费者组的相关信息，可以查看流、也可以单独查看流下的某个组的信息</span></span>
<span class="line"><span>127.0.0.1:6379&gt; xinfo stream mystream</span></span>
<span class="line"><span> 1) &quot;length&quot;</span></span>
<span class="line"><span> 2) (integer) 4  # 共 4 个消息</span></span>
<span class="line"><span> 3) &quot;radix-tree-keys&quot;</span></span>
<span class="line"><span> 4) (integer) 1</span></span>
<span class="line"><span> 5) &quot;radix-tree-nodes&quot;</span></span>
<span class="line"><span> 6) (integer) 2</span></span>
<span class="line"><span> 7) &quot;last-generated-id&quot;</span></span>
<span class="line"><span> 8) &quot;1609408943089-0&quot;</span></span>
<span class="line"><span> 9) &quot;groups&quot;</span></span>
<span class="line"><span>10) (integer) 1  # 一个消费组</span></span>
<span class="line"><span>11) &quot;first-entry&quot; # 第一个消息</span></span>
<span class="line"><span>12) 1) &quot;1609405178536-0&quot;</span></span>
<span class="line"><span>    2) 1) &quot;f5&quot;</span></span>
<span class="line"><span>       2) &quot;v5&quot;</span></span>
<span class="line"><span>13) &quot;last-entry&quot;  # 最后一个消息</span></span>
<span class="line"><span>14) 1) &quot;1609408943089-0&quot;</span></span>
<span class="line"><span>    2) 1) &quot;f6&quot;</span></span>
<span class="line"><span>       2) &quot;v6&quot;</span></span>
<span class="line"><span>127.0.0.1:6379&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="按消费组消费" tabindex="-1"><a class="header-anchor" href="#按消费组消费"><span>按消费组消费</span></a></h5><p>Stream 提供了 <code>xreadgroup</code> 指令可以进行消费组的组内消费，需要提供消费组名称、消费者名称和起始消息 ID。它同 <code>xread</code> 一样，也可以阻塞等待新消息。读到新消息后，对应的消息 ID 就会进入消费者的 PEL(正在处理的消息) 结构里，客户端处理完毕后使用 <code>xack</code> 指令通知服务器，本条消息已经处理完毕，该消息 ID 就会从 PEL 中移除。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>#  消费组 mygroup1 中的 消费者 c1 从 mystream 中 消费组数据</span></span>
<span class="line"><span># &gt; 号表示从当前消费组的 last_delivered_id 后面开始读</span></span>
<span class="line"><span># 每当消费者读取一条消息，last_delivered_id 变量就会前进</span></span>
<span class="line"><span>127.0.0.1:6379&gt; xreadgroup group mygroup1 c1 count 1 streams mystream &gt;</span></span>
<span class="line"><span>1) 1) &quot;mystream&quot;</span></span>
<span class="line"><span>   2) 1) 1) &quot;1609727806627-0&quot;</span></span>
<span class="line"><span>         2) 1) &quot;f1&quot;</span></span>
<span class="line"><span>            2) &quot;v1&quot;</span></span>
<span class="line"><span>            3) &quot;f2&quot;</span></span>
<span class="line"><span>            4) &quot;v2&quot;</span></span>
<span class="line"><span>            5) &quot;f3&quot;</span></span>
<span class="line"><span>            6) &quot;v3&quot;</span></span>
<span class="line"><span>127.0.0.1:6379&gt; xreadgroup group mygroup1 c1 count 1 streams mystream &gt;</span></span>
<span class="line"><span>1) 1) &quot;mystream&quot;</span></span>
<span class="line"><span>   2) 1) 1) &quot;1609727818650-0&quot;</span></span>
<span class="line"><span>         2) 1) &quot;f4&quot;</span></span>
<span class="line"><span>            2) &quot;v4&quot;</span></span>
<span class="line"><span># 已经没有消息可读了            </span></span>
<span class="line"><span>127.0.0.1:6379&gt; xreadgroup group mygroup1 c1 count 2 streams mystream &gt;</span></span>
<span class="line"><span>(nil)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 还可以阻塞式的消费</span></span>
<span class="line"><span>127.0.0.1:6379&gt; xreadgroup group mygroup1 c2 block 0 streams mystream &gt;</span></span>
<span class="line"><span>µ1) 1) &quot;mystream&quot;</span></span>
<span class="line"><span>   2) 1) 1) &quot;1609728270632-0&quot;</span></span>
<span class="line"><span>         2) 1) &quot;f5&quot;</span></span>
<span class="line"><span>            2) &quot;v5&quot;</span></span>
<span class="line"><span>(89.36s)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 观察消费组信息</span></span>
<span class="line"><span>127.0.0.1:6379&gt; xinfo groups mystream</span></span>
<span class="line"><span>1) 1) &quot;name&quot;</span></span>
<span class="line"><span>   2) &quot;mygroup1&quot;</span></span>
<span class="line"><span>   3) &quot;consumers&quot;</span></span>
<span class="line"><span>   4) (integer) 2  # 2个消费者</span></span>
<span class="line"><span>   5) &quot;pending&quot;</span></span>
<span class="line"><span>   6) (integer) 3   # 共 3 条正在处理的信息还没有 ack</span></span>
<span class="line"><span>   7) &quot;last-delivered-id&quot;</span></span>
<span class="line"><span>   8) &quot;1609728270632-0&quot;</span></span>
<span class="line"><span>   </span></span>
<span class="line"><span>127.0.0.1:6379&gt; xack mystream mygroup1 1609727806627-0  # ack掉指定消息</span></span>
<span class="line"><span>(integer) 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>尝鲜到此结束，就不继续深入了。</p><p>个人感觉，就目前来说，Stream 还是不能当做主流的 MQ 来使用的，而且使用案例也比较少，慎用。</p><h2 id="写在最后" tabindex="-1"><a class="header-anchor" href="#写在最后"><span>写在最后</span></a></h2><ul><li>当然，还有需要注意的就是，业务上避免过度复用一个 Redis。既用它做缓存、做计算，还拿它做任务队列，这样的话 Redis 会很累的。</li><li>没有绝对好的技术、只有对业务最友好的技术，共勉。</li></ul><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2><ul><li>《Redis 设计与实现》</li><li>Redis 官网</li><li><a href="https://segmentfault.com/a/1190000012244418" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000012244418</a></li><li><a href="https://www.cnblogs.com/williamjie/p/11201654.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/williamjie/p/11201654.html</a></li></ul></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/guide/MQ/Redis/Redis MQ.md" aria-label="在 GitHub 上编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><span class="vp-meta-info" data-allow-mismatch="text">2024/12/10 08:55:51</span></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: z1162289133@gmail.com">cyoukon</span><!--]--><!--]--></div></div></footer><!----><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">默认页脚</div><div class="vp-copyright">Copyright © 2024 Mr.Hope </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/vuepress-starter/assets/app-dX-INNG3.js" defer></script>
  </body>
</html>
